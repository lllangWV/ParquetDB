<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Examples for the ParquetDB package" href="../examples/index.html" /><link rel="prev" title="ParquetDB Internals" href="01%20-%20parquetdb_internals.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>Parquet File Format - ParquetDB Docs: v0.24.1</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">ParquetDB Docs: v0.24.1</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon no-toc" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../_static/ParquetDB_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">ParquetDB Docs: v0.24.1</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../01_tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../01_tutorials/01%20-%20Getting%20Started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_tutorials/02%20-%20Normalization.html">Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_tutorials/03%20-%20Advanced%20Reads.html">Advanced Read Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_tutorials/04%20-%20Supported%20Data%20Types.html">Supported Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_tutorials/05%20-%20Advanced%20Updates.html">Advanced Update Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_tutorials/06%20-%20Adding%20Metadata.html">Manipulating Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../01_tutorials/07%20-%20Helper%20Methods.html">Other Helper Methods</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">Internals of ParquetDB</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Internals of ParquetDB</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01%20-%20parquetdb_internals.html">ParquetDB Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="01%20-%20parquetdb_internals.html#input-data-formats">Input Data Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="01%20-%20parquetdb_internals.html#preprocessing-incoming-data">Preprocessing Incoming Data</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Parquet File Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parquet-file-layout">Parquet File Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-parquet-files-are-written">How Parquet Files are Written</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../examples/index.html">Examples for the ParquetDB package</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Examples for the ParquetDB package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/Example%201%20-%203D%20Alexandria%20Database.html">3D Alexandria Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/Example%202%20-%203D%20Alexandria%20Advanced.html">3D Alexandria Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/Example%203%20-%20Jarvis-dft_3d.html">ParquetDB with the Jarvis Dataset DFT_3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../examples/notebooks/Example%204%20-%20Jarvis-dft_pbe_2d.html">ParquetDB with the Jarvis Dataset DFT PBE 2D</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../03_api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../03_api/core/index.html">Core API</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Core API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../03_api/core/parquetdb.html">ParquetDB</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of ParquetDB</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../03_api/core/_autosummary/parquetdb.core.parquetdb.ParquetDB.html">parquetdb.core.parquetdb.ParquetDB</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../03_api/core/normalize_config.html">NormalizeConfig</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of NormalizeConfig</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../03_api/core/_autosummary/parquetdb.core.parquetdb.NormalizeConfig.html">parquetdb.core.parquetdb.NormalizeConfig</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../03_api/core/load_config.html">LoadConfig</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of LoadConfig</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../03_api/core/_autosummary/parquetdb.core.parquetdb.LoadConfig.html">parquetdb.core.parquetdb.LoadConfig</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../03_api/utils/index.html">Utils API</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Utils API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../03_api/utils/pyarrow_utils.html">PyArrowUtils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/02_internal/02 - parquet_file_format.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon no-toc" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="parquet-file-format">
<h1>Parquet File Format<a class="headerlink" href="#parquet-file-format" title="Link to this heading">¶</a></h1>
<p>At the heart of ParquetDB’s architecture is the use of Apache Parquet as the storage format. Parquet is a highly efficient columnar storage format specifically designed to address the complexities of fast query performance and efficient deserialization, particularly for large-scale, complex datasets. This layer directly addresses common data-handling challenges like serialization overhead, allowing ParquetDB to store and query complex datasets in a highly efficient manner. The benefits of Parquet files are:</p>
<ul class="simple">
<li><p><strong>Columnar Format:</strong> Parquet organizes data by columns instead of rows, making it ideal for analytical queries that require only subsets of columns. This format allows for better compression and reduces I/O overhead.</p></li>
<li><p><strong>Schema Embedding:</strong> Each Parquet file contains a schema that describes the data, ensuring consistency and facilitating schema evolution.</p></li>
<li><p><strong>Predicate Pushdown:</strong> Parquet’s structure allows ParquetDB to optimize queries by reading only relevant data blocks.</p></li>
<li><p><strong>Predicate Pushdown:</strong> Parquet’s structure also enables reading only the relevant columns into memory.</p></li>
<li><p><strong>Efficient Encoding and Compression:</strong> Parquet files allow for column-level encoding and compression techniques, improving both read performance and storage efficiency.</p></li>
<li><p><strong>Metadata Support:</strong> Parquet files can store table- and column-level metadata.</p></li>
<li><p><strong>Batching Support:</strong> Parquet files handle data in batches (groups of column data) which makes them conducive to batching operations.</p></li>
</ul>
<p>By using Parquet files, ParquetDB optimizes the serialization and deserialization process, providing fast and scalable data access that fits seamlessly into machine learning and big data pipelines.</p>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../_images/parquet_file_format.png"><img alt="../_images/parquet_file_format.png" src="../_images/parquet_file_format.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text"><strong>Parquet File Format Overview.</strong> This diagram illustrates the structure of a Parquet file, including Row Groups, Columns, Pages, and the Footer. The metadata associated with each level provides essential details, such as schema, offsets, compression sizes, encryption, and statistical summaries. These metadata components enable efficient data storage, retrieval, and filtering, making Parquet an ideal choice for analytics and big data processing.</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The structure of a Parquet file is depicted in <em>Figure 3</em>, where files are partitioned into row groups, which are further divided into column chunks. Each column chunk is composed of pages, representing the smallest unit of storage. A footer at the end of each file consolidates critical metadata, including schema information and statistics for each row group, such as minimum and maximum values. This hierarchical organization supports advanced features such as predicate pushdown and columnar projection, while facilitating efficient data compression and retrieval.</p>
<p>Traditional data storage formats often involve a compromise between row-based storage (optimized for transactional workloads) and column-based storage (ideal for analytical queries). Parquet introduces a hybrid storage model that leverages the benefits of both paradigms, enabling data to be stored in a columnar format while maintaining efficiency for diverse query types. To fully appreciate the advantages of Parquet’s hybrid approach, it is crucial to understand the distinction between traditional row-based and column-based formats (see <em>Figure 4</em> for an illustration of data organization and access differences). Row-based formats (e.g., CSV or relational databases) store data sequentially by row, making them ideal for workloads requiring frequent row-level operations. However, they are inefficient for analytical queries, which often require scanning entire rows even when only specific columns are needed. In contrast, column-based formats, commonly used in data warehouses, store values from the same column together, enabling faster aggregations and more efficient analytics. Parquet’s predominantly columnar approach effectively bridges the gap between transactional and analytical workloads.</p>
<p>Parquet files utilize metadata extensively to optimize data access. This metadata includes schema information, statistics, and offsets, which enable query engines to make informed decisions about data retrieval. For instance, detailed statistics such as minimum and maximum values for each column facilitate predicate pushdown, allowing query engines to bypass irrelevant row groups or pages based on filter conditions. Schema metadata ensures data type consistency, mitigating serialization errors and enhancing interoperability across different platforms. This rich metadata makes Parquet files self-descriptive, significantly improving both usability and performance.</p>
<p>Through detailed metadata, Parquet optimizes data retrieval using several key mechanisms:</p>
<ul class="simple">
<li><p><strong>Predicate Pushdown:</strong> Allows the query engine to filter data directly at the storage level, similar to applying a WHERE clause in SQL.</p></li>
<li><p><strong>Projection Pushdown:</strong> Ensures that only the required columns are retrieved, akin to using the SELECT statement in SQL.</p></li>
</ul>
<p>By minimizing the volume of data processed and loaded into memory, these features significantly enhance query performance and reduce computational overhead, making Parquet an ideal choice for big data applications.</p>
<p>Building upon metadata optimization, Parquet achieves high efficiency by minimizing data size through encoding and compression techniques. Encoding reduces data size while preserving direct access to each data point, and compression further reduces the data footprint, saving storage space and optimizing performance for data transfer operations. Parquet supports various encoding techniques (e.g., Plain, Dictionary, Run-Length, Delta) and compression codecs (e.g., GZIP, LZO, BROTLI, ZSTD, LZ4_RAW) that work together to reduce data size and improve performance.</p>
<p>Apache Parquet’s robust architecture, rich metadata, and sophisticated encoding/compression strategies make it an ideal foundation for a database. In the next section, we will explore the design and architecture of ParquetDB, demonstrating how these strengths are leveraged to create an efficient, portable database solution. For additional details on the Parquet File format, please refer to the Supplemental Information (SI).</p>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../_images/row_group_storage.png"><img alt="../_images/row_group_storage.png" src="../_images/row_group_storage.png" style="width: 80%;" />
</a>
<figcaption>
<p><span class="caption-text"><strong>Comparison of Storage Layouts.</strong> Row-Based, Column-Based, and Hybrid-Based (Row Group Size = 2). Parquet files utilize a hybrid storage layout, balancing the strengths of row-based and column-based storage by grouping rows together for efficient read and write operations, making them suitable for analytic queries on large datasets.</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="parquet-file-layout">
<h1>Parquet File Layout<a class="headerlink" href="#parquet-file-layout" title="Link to this heading">¶</a></h1>
<p>The Parquet file structure is engineered for optimal performance. Parquet files are partitioned into row groups (horizontal partitions of the dataset), with each row group further divided into column chunks. Each column chunk comprises pages—the smallest storage unit in Parquet. At the end of each file, a footer is appended that contains essential metadata such as the schema, field-level information, and row group statistics (e.g., minimum and maximum values). This hierarchical organization facilitates efficient compression, retrieval, and supports advanced features like predicate pushdown and columnar projection. Metadata is stored at various levels:</p>
<ul class="simple">
<li><p><strong>File-Level Metadata:</strong> Describes the overall structure of the file.</p></li>
<li><p><strong>Row Group Metadata:</strong> Contains statistics critical for query optimization.</p></li>
</ul>
<section id="pages">
<h2>Pages<a class="headerlink" href="#pages" title="Link to this heading">¶</a></h2>
<p>Pages in Parquet files store the actual data. Each page is composed of two main components:</p>
<ul class="simple">
<li><p><strong>Page Header:</strong> Contains metadata such as data type, uncompressed/compressed page sizes, codec, and encoding details. If dictionary encoding is used, it may also include dictionary page header information.</p></li>
<li><p><strong>Data Page:</strong> Contains the actual encoded data. If dictionary encoding is used, a separate dictionary page holds the unique values.</p></li>
</ul>
</section>
<section id="bloom-filter">
<h2>Bloom Filter<a class="headerlink" href="#bloom-filter" title="Link to this heading">¶</a></h2>
<p>A Bloom filter is located before the column index and offset index. It provides a probabilistic data structure for quickly testing whether an element is present in a set, aiding in efficient data filtering.</p>
</section>
<section id="page-index">
<h2>Page Index<a class="headerlink" href="#page-index" title="Link to this heading">¶</a></h2>
<p>The Page Index is located in the footer and provides critical statistics for each data page, enabling efficient data scanning. It consists of:</p>
<ul class="simple">
<li><p><strong>ColumnIndex:</strong> Helps locate data pages containing specific values for a scan predicate.</p></li>
<li><p><strong>OffsetIndex:</strong> Assists in navigating by row index to retrieve matching values across columns.</p></li>
</ul>
<p>These structures allow the reader to access only the necessary data pages, reducing the overhead of reading irrelevant data.</p>
</section>
<section id="footer">
<h2>Footer<a class="headerlink" href="#footer" title="Link to this heading">¶</a></h2>
<p>The footer is a critical component that consolidates the file’s metadata. It includes:</p>
<section id="filemetadata">
<h3>FileMetaData<a class="headerlink" href="#filemetadata" title="Link to this heading">¶</a></h3>
<ul class="simple">
<li><p><strong>Schema:</strong> Describes each column (names, data types, repetition levels, etc.).</p></li>
<li><p><strong>Version:</strong> The Parquet format version used.</p></li>
<li><p><strong>Number of Rows:</strong> Total number of rows in the file.</p></li>
<li><p><strong>Key Value Metadata:</strong> Optional user-defined metadata.</p></li>
<li><p><strong>Created by:</strong> The software version that created the file.</p></li>
<li><p><strong>Column Order:</strong> Specifies the ordering of columns.</p></li>
<li><p><strong>Encryption Algorithm:</strong> If encryption is used.</p></li>
<li><p><strong>Footer Signing Key Metadata:</strong> Related to encryption.</p></li>
</ul>
</section>
<section id="schema">
<h3>Schema<a class="headerlink" href="#schema" title="Link to this heading">¶</a></h3>
<p>Details each column, including:</p>
<ul class="simple">
<li><p><strong>Column Names</strong></p></li>
<li><p><strong>Data Types:</strong> e.g., <cite>INT32</cite>, <cite>FLOAT</cite>, <cite>BYTE_ARRAY</cite></p></li>
<li><p><strong>Logical Types:</strong> e.g., <cite>DECIMAL</cite>, <cite>DATE</cite>, <cite>TIMESTAMP</cite></p></li>
<li><p><strong>Repetition Levels:</strong> Required, optional, or repeated.</p></li>
<li><p><strong>Nested Structures:</strong> Details of complex types such as structs, maps, and lists.</p></li>
</ul>
</section>
<section id="row-group-metadata">
<h3>Row Group MetaData<a class="headerlink" href="#row-group-metadata" title="Link to this heading">¶</a></h3>
<p>Each row group (a horizontal partition) has metadata that includes:</p>
<ul class="simple">
<li><p><strong>Column Chunks:</strong> Metadata for each column chunk.</p></li>
<li><p><strong>Total Uncompressed and Compressed Sizes</strong></p></li>
<li><p><strong>Number of Rows</strong></p></li>
<li><p><strong>Sorting Columns:</strong> If applicable.</p></li>
<li><p><strong>File Offset and Ordinal:</strong> For locating the row group in the file.</p></li>
</ul>
</section>
<section id="columnchunk-metadata">
<h3>ColumnChunk MetaData<a class="headerlink" href="#columnchunk-metadata" title="Link to this heading">¶</a></h3>
<p>Metadata specific to each column chunk:</p>
<ul class="simple">
<li><p><strong>File Path and Offset</strong></p></li>
<li><p><strong>Offset and Column Index Offsets/Lengths</strong></p></li>
<li><p><strong>Encryption Metadata</strong></p></li>
<li><p><strong>Encrypted Metadata:</strong> If applicable.</p></li>
</ul>
</section>
<section id="column-metadata">
<h3>Column MetaData<a class="headerlink" href="#column-metadata" title="Link to this heading">¶</a></h3>
<p>Details for each column chunk include:</p>
<ul class="simple">
<li><p><strong>Type and Encodings</strong></p></li>
<li><p><strong>Path in the Schema</strong></p></li>
<li><p><strong>Compression Codec</strong></p></li>
<li><p><strong>Number of Values</strong></p></li>
<li><p><strong>Uncompressed and Compressed Sizes</strong></p></li>
<li><p><strong>Key Value Metadata</strong></p></li>
<li><p><strong>Data, Index, and Dictionary Page Offsets</strong></p></li>
<li><p><strong>Statistics:</strong> Min, max, null count, etc.</p></li>
<li><p><strong>Encoding Statistics</strong></p></li>
<li><p><strong>Bloom Filter Offset and Length</strong></p></li>
</ul>
</section>
</section>
</section>
<section id="how-parquet-files-are-written">
<h1>How Parquet Files are Written<a class="headerlink" href="#how-parquet-files-are-written" title="Link to this heading">¶</a></h1>
<p>Understanding how Parquet files are written is essential to appreciating their efficiency. Although Parquet is a columnar format, data is initially written row by row. Each row is decomposed into individual columns, and the values are accumulated in in-memory column stores. During this phase, metadata such as minimum and maximum values and NULL counts are updated for each column.</p>
<p>When the first 100 rows (or a threshold) are written, the Parquet writer checks if the raw data size exceeds the page size threshold (typically 1 MB). If the size is below the threshold, subsequent pages are adjusted dynamically; otherwise, the data is compressed and flushed to the page store. Each page includes a header with metadata (uncompressed/compressed sizes, value count, statistics, etc.).</p>
<p>After the first 100 rows, the writer checks if the total data size exceeds the row group size (default is 128 MB). If not, the writer adjusts the next check dynamically; if so, the data is flushed to the output stream (e.g., HadoopPositionOutputStream) column by column. Once a row group is flushed, its memory is freed. Note that row groups do not include metadata—this is appended in the footer.</p>
<p>Finally, after all row groups are written, the footer is appended to the file. The footer contains the file schema and row group metadata (total size, number of rows, column statistics, etc.), enabling efficient data retrieval without requiring the entire file to reside in memory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Storing metadata in the footer allows the Parquet writer to flush row groups immediately after completion, minimizing memory usage.</p>
</div>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../examples/index.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Examples for the ParquetDB package</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="01%20-%20parquetdb_internals.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">ParquetDB Internals</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Logan Lang
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer no-toc">
      
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=0d70ca51"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/custom.js"></script>
    </body>
</html>