<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../../genindex.html" /><link rel="search" title="Search" href="../../search.html" /><link rel="next" title="3D Alexandria Advanced" href="Example%202%20-%203D%20Alexandria%20Advanced.html" /><link rel="prev" title="Examples for the ParquetDB package" href="../index.html" />

    <!-- Generated with Sphinx 7.4.7 and Furo 2024.08.06 -->
        <title>3D Alexandria Database - ParquetDB Docs: v0.25.1</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/notebook.css?v=3901a606" />
    
    


<style>
  body {
    --color-code-background: #eeffcc;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #272822;
  --color-code-foreground: #f8f8f2;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../index.html"><div class="brand">ParquetDB Docs: v0.25.1</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../index.html">
  
  <div class="sidebar-logo-container">
    <img class="sidebar-logo" src="../../_static/ParquetDB_logo.png" alt="Logo"/>
  </div>
  
  <span class="sidebar-brand-text">ParquetDB Docs: v0.25.1</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../01_tutorials/index.html">Tutorials</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Tutorials</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../01_tutorials/01%20-%20Getting%20Started.html">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_tutorials/02%20-%20Normalization.html">Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_tutorials/03%20-%20Advanced%20Reads.html">Advanced Read Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_tutorials/04%20-%20Supported%20Data%20Types.html">Supported Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_tutorials/05%20-%20Advanced%20Updates.html">Advanced Update Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_tutorials/06%20-%20Adding%20Metadata.html">Manipulating Metadata</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../01_tutorials/07%20-%20Helper%20Methods.html">Other Helper Methods</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../02_internal/index.html">Internals of ParquetDB</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Internals of ParquetDB</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../02_internal/01%20-%20parquetdb_internals.html">ParquetDB Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_internal/01%20-%20parquetdb_internals.html#input-data-formats">Input Data Formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_internal/01%20-%20parquetdb_internals.html#preprocessing-incoming-data">Preprocessing Incoming Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_internal/02%20-%20parquet_file_format.html">Parquet File Format</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_internal/02%20-%20parquet_file_format.html#parquet-file-layout">Parquet File Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../02_internal/02%20-%20parquet_file_format.html#how-parquet-files-are-written">How Parquet Files are Written</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../index.html">Examples for the ParquetDB package</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Examples for the ParquetDB package</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">3D Alexandria Database</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example%202%20-%203D%20Alexandria%20Advanced.html">3D Alexandria Advanced</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example%203%20-%20Jarvis-dft_3d.html">ParquetDB with the Jarvis Dataset DFT_3D</a></li>
<li class="toctree-l2"><a class="reference internal" href="Example%204%20-%20Jarvis-dft_pbe_2d.html">ParquetDB with the Jarvis Dataset DFT PBE 2D</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarks/Needle-in-Haystack%20Benchmark.html">Needle-in-Haystack Benchmark Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarks/Input%20Update%20Benchmark.html">Input Update Benchmark Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarks/Create%20and%20Read%20Benchmark.html">Read/Write Benchmark Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarks/Update%20Into%20Constant%20Rows%20Benchmark.html">Update Benchmark Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarks/Full%20DB%20Updates%20Benchmark.html">Full DB Updates Benchmark Notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../benchmarks/Small%20Benchmark.html">Small Benchmark</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../03_api/index.html">API Reference</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of API Reference</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../03_api/core/index.html">Core API</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Core API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../03_api/core/parquetdb.html">ParquetDB</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of ParquetDB</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../03_api/core/_autosummary/parquetdb.core.parquetdb.ParquetDB.html">parquetdb.core.parquetdb.ParquetDB</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../03_api/core/normalize_config.html">NormalizeConfig</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of NormalizeConfig</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../03_api/core/_autosummary/parquetdb.core.parquetdb.NormalizeConfig.html">parquetdb.core.parquetdb.NormalizeConfig</a></li>
</ul>
</li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../03_api/core/load_config.html">LoadConfig</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of LoadConfig</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l4"><a class="reference internal" href="../../03_api/core/_autosummary/parquetdb.core.parquetdb.LoadConfig.html">parquetdb.core.parquetdb.LoadConfig</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../03_api/utils/index.html">Utils API</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Utils API</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../../03_api/utils/pyarrow_utils.html">PyArrowUtils</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">Contributing</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../../_sources/examples/notebooks/Example 1 - 3D Alexandria Database.ipynb.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="3D-Alexandria-Database">
<h1>3D Alexandria Database<a class="headerlink" href="#3D-Alexandria-Database" title="Link to this heading">¶</a></h1>
<p><img alt="alexandria_3d" src="../../_images/alexandria_3d_database.png" /></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>parquetdb
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>pymatgen
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyarrow</span> <span class="kn">import</span> <span class="n">compute</span> <span class="k">as</span> <span class="n">pc</span>

<span class="kn">from</span> <span class="nn">parquetdb.core.parquetdb</span> <span class="kn">import</span> <span class="n">LoadConfig</span><span class="p">,</span> <span class="n">NormalizeConfig</span>
<span class="kn">from</span> <span class="nn">parquetdb.utils.general_utils</span> <span class="kn">import</span> <span class="n">timeit</span>
<span class="kn">from</span> <span class="nn">parquetdb</span> <span class="kn">import</span> <span class="n">ParquetDB</span><span class="p">,</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">parquetdb.utils.external_utils</span> <span class="kn">import</span> <span class="n">download_alexandria_3d_database</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
<section id="Setup">
<h2>Setup<a class="headerlink" href="#Setup" title="Link to this heading">¶</a></h2>
<section id="Setup-data-directories">
<h3>Setup data directories<a class="headerlink" href="#Setup-data-directories" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;external&quot;</span><span class="p">,</span> <span class="s2">&quot;alexandria&quot;</span><span class="p">,</span> <span class="s2">&quot;AlexandriaDB&quot;</span><span class="p">)</span>
<span class="n">benchmark_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;benchmarks&quot;</span><span class="p">,</span> <span class="s2">&quot;alexandria&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Download-the-database">
<h3>Download the database<a class="headerlink" href="#Download-the-database" title="Link to this heading">¶</a></h3>
<p>Lets download the database</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">download_alexandria_database</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">from_scratch</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: download_alexandria_database&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">from_scratch</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">base_dir</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing existing directory: </span><span class="si">{</span><span class="n">base_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Here we download the database and save it to the data directory</span>
    <span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">.</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;external&quot;</span><span class="p">,</span> <span class="s2">&quot;alexandria&quot;</span><span class="p">)</span>
    <span class="n">alexandria_dir</span> <span class="o">=</span> <span class="n">download_alexandria_3d_database</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">n_cores</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: download_alexandria_database&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">alexandria_dir</span>


<span class="n">alexandria_dir</span> <span class="o">=</span> <span class="n">download_alexandria_database</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="n">from_scratch</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">alexandria_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: download_alexandria_database
Database downloaded already. Skipping download.
Done with task: download_alexandria_database
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Z:\data\parquetdb\data\external\alexandria\uncompressed
</pre></div></div>
</div>
</section>
</section>
<section id="Creating-the-database">
<h2>Creating the database<a class="headerlink" href="#Creating-the-database" title="Link to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">db</span> <span class="o">=</span> <span class="n">ParquetDB</span><span class="p">(</span><span class="n">db_path</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">base_dir</span><span class="p">,</span> <span class="s2">&quot;alexandria_3D&quot;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[INFO] 2025-04-22 09:14:49 - parquetdb.core.parquetdb[205][__init__] - Initializing ParquetDB with db_path: Z:\data\parquetdb\data\external\alexandria\AlexandriaDB\alexandria_3D
[INFO] 2025-04-22 09:14:49 - parquetdb.core.parquetdb[207][__init__] - verbose: 1
============================================================
PARQUETDB SUMMARY
============================================================
Database path: Z:\data\parquetdb\data\external\alexandria\AlexandriaDB\alexandria_3D

• Number of columns: 128
• Number of rows: 4389295
• Number of files: 1
• Number of rows per file: [4389295]
• Number of row groups per file: [22]
• Serialized metadata size per file: [377883] Bytes

############################################################
METADATA
############################################################

############################################################
COLUMN DETAILS
############################################################

</pre></div></div>
</div>
<p>Lets Define some dictionaries to store some benchmark results</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">benchmark_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;create_times&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;json_load_times&quot;</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">&quot;n_rows_per_file&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">}</span>

<span class="n">task_benchmark_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;task_names&quot;</span><span class="p">:</span> <span class="p">[],</span> <span class="s2">&quot;task_times&quot;</span><span class="p">:</span> <span class="p">[]}</span>
</pre></div>
</div>
</div>
<section id="Inputing-the-data">
<h3>Inputing the data<a class="headerlink" href="#Inputing-the-data" title="Link to this heading">¶</a></h3>
<p>Here I am just iterating over the json files and creating the database. I am also storing how long it takes to load each json file, how many materials, and how long it takes to input the data into the database.</p>
<p>This dataset is rather large, so you may have to choose the normalization parameters depending on how much RAM you have. If you do not have enough tweak the <code class="docutils literal notranslate"><span class="pre">batch_size</span></code>, <code class="docutils literal notranslate"><span class="pre">batch_readahead</span></code>, <code class="docutils literal notranslate"><span class="pre">fragment_readahead</span></code> parameters.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_database_if_empty</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">alexandria_dir</span><span class="p">,</span> <span class="n">normalize_config</span><span class="o">=</span><span class="n">NormalizeConfig</span><span class="p">()):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;_summary_</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    db : ParquetDB Instance</span>
<span class="sd">        The database instance to create the dataset on.</span>
<span class="sd">    alexandria_dir : str</span>
<span class="sd">        The directory containing the json files to input into the database.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    _type_</span>
<span class="sd">        _description_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: create_database_if_empty&quot;</span><span class="p">)</span>

    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">json_load_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">create_times</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">n_materials_per_file</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">db</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The dataset does not exist. Creating it.&quot;</span><span class="p">)</span>
        <span class="n">json_files</span> <span class="o">=</span> <span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">alexandria_dir</span><span class="p">,</span> <span class="s2">&quot;*.json&quot;</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">json_file</span> <span class="ow">in</span> <span class="n">json_files</span><span class="p">[:]:</span>

            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">json_file</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="n">json_load_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="n">base_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
            <span class="n">n_materials</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">])</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing file: </span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of materials: </span><span class="si">{</span><span class="n">n_materials</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Since we are importing alot of data it is best</span>
                <span class="c1"># to normalize the database afterwards</span>
                <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="n">db</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;entries&quot;</span><span class="p">],</span>
                    <span class="n">normalize_dataset</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">normalize_config</span><span class="o">=</span><span class="n">normalize_config</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">create_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

                <span class="n">create_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">create_time</span><span class="p">)</span>
                <span class="n">n_materials_per_file</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n_materials</span><span class="p">)</span>
                <span class="n">json_load_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json_load_time</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>

            <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time taken to create dataset: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: create_database_if_empty&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">json_load_times</span><span class="p">,</span> <span class="n">create_times</span><span class="p">,</span> <span class="n">n_materials_per_file</span>


<span class="n">normalize_config</span> <span class="o">=</span> <span class="n">NormalizeConfig</span><span class="p">(</span>
    <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;batches&quot;</span><span class="p">,</span>  <span class="c1"># Uses the batch generator to normalize</span>
    <span class="n">batch_readahead</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>  <span class="c1"># Controls the number of batches to load in memory a head of time. This will have impacts on amount of RAM consumed</span>
    <span class="n">fragment_readahead</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>  <span class="c1"># Controls the number of files to load in memory ahead of time. This will have impacts on amount of RAM consumed</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>  <span class="c1"># Controls the batchsize when to use when normalizing. This will have impacts on amount of RAM consumed</span>
    <span class="n">max_rows_per_file</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>  <span class="c1"># Controls the max number of rows per parquet file</span>
    <span class="n">max_rows_per_group</span><span class="o">=</span><span class="mi">100000</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Controls the max number of rows per group parquet</span>


<span class="n">json_load_times</span><span class="p">,</span> <span class="n">create_times</span><span class="p">,</span> <span class="n">n_materials_per_file</span> <span class="o">=</span> <span class="n">create_database_if_empty</span><span class="p">(</span>
    <span class="n">db</span><span class="p">,</span> <span class="n">alexandria_dir</span><span class="p">,</span> <span class="n">normalize_config</span><span class="o">=</span><span class="n">normalize_config</span>
<span class="p">)</span>

<span class="n">benchmark_dict</span><span class="p">[</span><span class="s2">&quot;create_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_times</span>
<span class="n">benchmark_dict</span><span class="p">[</span><span class="s2">&quot;json_load_times&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">json_load_times</span>
<span class="n">benchmark_dict</span><span class="p">[</span><span class="s2">&quot;n_rows_per_file&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n_materials_per_file</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: create_database_if_empty
Done with task: create_database_if_empty
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
</pre></div></div>
</div>
</section>
</section>
<section id="Normalizing-the-dataset">
<h2>Normalizing the dataset<a class="headerlink" href="#Normalizing-the-dataset" title="Link to this heading">¶</a></h2>
<p>It is best practive to normalize the dataset after all the data has been inputed. This will optimize the performance of the database.</p>
<p>First let’s see how the data is distributed in the row groups.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">summary</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">show_row_group_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
============================================================
PARQUETDB SUMMARY
============================================================
Database path: Z:\data\parquetdb\data\external\alexandria\AlexandriaDB\alexandria_3D

• Number of columns: 128
• Number of rows: 4389295
• Number of files: 1
• Number of rows per file: [4389295]
• Number of row groups per file: [22]
• Number of rows per row group per file:
    - alexandria_3D_0.parquet:
        - Row group 0: 200000 rows
        - Row group 1: 200000 rows
        - Row group 2: 200000 rows
        - Row group 3: 200000 rows
        - Row group 4: 200000 rows
        - Row group 5: 200000 rows
        - Row group 6: 200000 rows
        - Row group 7: 200000 rows
        - Row group 8: 200000 rows
        - Row group 9: 200000 rows
        - Row group 10: 200000 rows
        - Row group 11: 200000 rows
        - Row group 12: 200000 rows
        - Row group 13: 200000 rows
        - Row group 14: 200000 rows
        - Row group 15: 200000 rows
        - Row group 16: 200000 rows
        - Row group 17: 200000 rows
        - Row group 18: 200000 rows
        - Row group 19: 200000 rows
        - Row group 20: 200000 rows
        - Row group 21: 189295 rows
• Serialized metadata size per file: [377883] Bytes

############################################################
METADATA
############################################################

############################################################
COLUMN DETAILS
############################################################

</pre></div></div>
</div>
<p>Let’s check the file size of the parquet files.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">list_file_sizes</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">in_MB</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Lists the size of files in a directory.</span>

<span class="sd">    Args:</span>
<span class="sd">      directory: The path to the directory.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">file_sizes</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">directory</span><span class="p">):</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">):</span>
            <span class="n">file_size</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">in_MB</span><span class="p">:</span>
                <span class="n">file_size</span> <span class="o">=</span> <span class="n">file_size</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">)</span>
            <span class="n">file_sizes</span><span class="p">[</span><span class="n">filename</span><span class="p">]</span> <span class="o">=</span> <span class="n">file_size</span>
    <span class="k">return</span> <span class="n">file_sizes</span>


<span class="n">file_sizes</span> <span class="o">=</span> <span class="n">list_file_sizes</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">file_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
alexandria_3D_0.parquet: 2767.1490955352783 MB
</pre></div></div>
</div>
<p>Let’s also check the size of the row groups.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">row_group_metadata_per_file</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_parquet_file_row_group_metadata_per_file</span><span class="p">(</span>
    <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">row_group_size_per_file</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">sum_row_group_size</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_row_groups</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">row_group_metadata</span> <span class="ow">in</span> <span class="n">row_group_metadata_per_file</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">row_group_size_per_file</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">row_group</span><span class="p">,</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">row_group_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">row_group_size_per_file</span><span class="p">[</span><span class="n">file</span><span class="p">][</span><span class="n">row_group</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;total_byte_size&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
            <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="p">)</span>
        <span class="n">sum_row_group_size</span> <span class="o">+=</span> <span class="n">row_group_size_per_file</span><span class="p">[</span><span class="n">file</span><span class="p">][</span><span class="n">row_group</span><span class="p">]</span>
        <span class="n">num_row_groups</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">row_group</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row_group_size_per_file</span><span class="p">[</span><span class="n">file</span><span class="p">][</span><span class="n">row_group</span><span class="p">]</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average row group size: </span><span class="si">{</span><span class="n">sum_row_group_size</span><span class="o">/</span><span class="n">num_row_groups</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
alexandria_3D_0.parquet
     0: 201.08054542541504 MB
     1: 220.59319686889648 MB
     2: 197.38053512573242 MB
     3: 187.26845264434814 MB
     4: 227.97186374664307 MB
     5: 192.6089096069336 MB
     6: 216.52346420288086 MB
     7: 198.00727558135986 MB
     8: 227.92319583892822 MB
     9: 226.87678337097168 MB
     10: 244.66320514678955 MB
     11: 215.52607440948486 MB
     12: 198.7313060760498 MB
     13: 204.19597339630127 MB
     14: 192.36825561523438 MB
     15: 217.40732860565186 MB
     16: 215.3526430130005 MB
     17: 201.5632438659668 MB
     18: 189.40394115447998 MB
     19: 200.09145641326904 MB
     20: 208.74722480773926 MB
     21: 206.02736282348633 MB
Average row group size: 208.65055626088923 MB
</pre></div></div>
</div>
<p>For the most optimal performance we should aim for 2GB per file and about 200-500MB per row group.</p>
<p>Currently for a row group with 32,768 rows the size of the row group is ~30MB. To get to 200MB we should put 200MB/30MB more rows in the row group or ~200,000 rows.</p>
<p>If each rowgroup is about 200MB at 200,000 rows then we should have 2GB/200MB = 10 row groups per file. or 2,000,000 rows per file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalize_dataset</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">normalize_config</span><span class="o">=</span><span class="n">NormalizeConfig</span><span class="p">()):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;normalize_dataset&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: normalize_dataset&quot;</span><span class="p">)</span>

    <span class="n">db</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">normalize_config</span><span class="o">=</span><span class="n">normalize_config</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: normalize_dataset&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">normalize_config</span> <span class="o">=</span> <span class="n">NormalizeConfig</span><span class="p">(</span>
    <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;batches&quot;</span><span class="p">,</span>  <span class="c1"># Uses the batch generator to normalize</span>
    <span class="n">batch_readahead</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>  <span class="c1"># Controls the number of batches to load in memory a head of time. This will have impacts on amount of RAM consumed</span>
    <span class="n">fragment_readahead</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Controls the number of files to load in memory ahead of time. This will have impacts on amount of RAM consumed</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>  <span class="c1"># Controls the batchsize when to use when normalizing. This will have impacts on amount of RAM consumed</span>
    <span class="n">max_rows_per_file</span><span class="o">=</span><span class="mi">2000000</span><span class="p">,</span>  <span class="c1"># Controls the max number of rows per parquet file</span>
    <span class="n">max_rows_per_group</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
    <span class="n">min_rows_per_group</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Controls the max number of rows per group parquet file</span>
<span class="n">normalize_dataset</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">normalize_config</span><span class="o">=</span><span class="n">normalize_config</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">show_row_group_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: normalize_dataset
Done with task: normalize_dataset
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
============================================================
PARQUETDB SUMMARY
============================================================
Database path: Z:\data\parquetdb\data\external\alexandria\AlexandriaDB\alexandria_3D

• Number of columns: 128
• Number of rows: 4389295
• Number of files: 3
• Number of rows per file: [2000000, 2000000, 389295]
• Number of row groups per file: [10, 10, 2]
• Number of rows per row group per file:
    - alexandria_3D_0.parquet:
        - Row group 0: 200000 rows
        - Row group 1: 200000 rows
        - Row group 2: 200000 rows
        - Row group 3: 200000 rows
        - Row group 4: 200000 rows
        - Row group 5: 200000 rows
        - Row group 6: 200000 rows
        - Row group 7: 200000 rows
        - Row group 8: 200000 rows
        - Row group 9: 200000 rows
    - alexandria_3D_1.parquet:
        - Row group 0: 200000 rows
        - Row group 1: 200000 rows
        - Row group 2: 200000 rows
        - Row group 3: 200000 rows
        - Row group 4: 200000 rows
        - Row group 5: 200000 rows
        - Row group 6: 200000 rows
        - Row group 7: 200000 rows
        - Row group 8: 200000 rows
        - Row group 9: 200000 rows
    - alexandria_3D_2.parquet:
        - Row group 0: 200000 rows
        - Row group 1: 189295 rows
• Serialized metadata size per file: [180572, 178843, 48142] Bytes

############################################################
METADATA
############################################################

############################################################
COLUMN DETAILS
############################################################

</pre></div></div>
</div>
<p>Let’s check the file sizes and row group sizes again.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">file_sizes</span> <span class="o">=</span> <span class="n">list_file_sizes</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>

<span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">file_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>


<span class="n">row_group_metadata_per_file</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">get_parquet_file_row_group_metadata_per_file</span><span class="p">(</span>
    <span class="n">as_dict</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">row_group_size_per_file</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">sum_row_group_size</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">num_row_groups</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">row_group_metadata</span> <span class="ow">in</span> <span class="n">row_group_metadata_per_file</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">row_group_size_per_file</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">row_group</span><span class="p">,</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="n">row_group_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">row_group_size_per_file</span><span class="p">[</span><span class="n">file</span><span class="p">][</span><span class="n">row_group</span><span class="p">]</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;total_byte_size&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span>
            <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span>
        <span class="p">)</span>
        <span class="n">sum_row_group_size</span> <span class="o">+=</span> <span class="n">row_group_size_per_file</span><span class="p">[</span><span class="n">file</span><span class="p">][</span><span class="n">row_group</span><span class="p">]</span>
        <span class="n">num_row_groups</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     </span><span class="si">{</span><span class="n">row_group</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">row_group_size_per_file</span><span class="p">[</span><span class="n">file</span><span class="p">][</span><span class="n">row_group</span><span class="p">]</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Average row group size: </span><span class="si">{</span><span class="n">sum_row_group_size</span><span class="o">/</span><span class="n">num_row_groups</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
alexandria_3D_0.parquet: 1261.4758415222168 MB
alexandria_3D_1.parquet: 1251.6552095413208 MB
alexandria_3D_2.parquet: 254.18556213378906 MB
alexandria_3D_0.parquet
     0: 201.72274780273438 MB
     1: 219.45661544799805 MB
     2: 197.442889213562 MB
     3: 187.3084535598755 MB
     4: 227.44355964660645 MB
     5: 192.6088399887085 MB
     6: 216.52346420288086 MB
     7: 198.00727558135986 MB
     8: 227.92319583892822 MB
     9: 226.87678337097168 MB
alexandria_3D_1.parquet
     0: 244.66320514678955 MB
     1: 215.52607440948486 MB
     2: 198.7313995361328 MB
     3: 203.92721366882324 MB
     4: 191.9358901977539 MB
     5: 218.27143096923828 MB
     6: 215.63258838653564 MB
     7: 201.5486354827881 MB
     8: 191.0305995941162 MB
     9: 199.67366981506348 MB
alexandria_3D_2.parquet
     0: 208.74722480773926 MB
     1: 206.0274362564087 MB
Average row group size: 208.6831451329318 MB
</pre></div></div>
</div>
<p>Here we see that the row groups are about 200MB and the file sizes are a 1GB. This is a little smaller because the less files the more common metadata is stored together. I would try to store all the data in the same file in this case</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">normalize_config</span> <span class="o">=</span> <span class="n">NormalizeConfig</span><span class="p">(</span>
    <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;batches&quot;</span><span class="p">,</span>  <span class="c1"># Uses the batch generator to normalize</span>
    <span class="n">batch_readahead</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>  <span class="c1"># Controls the number of batches to load in memory a head of time. This will have impacts on amount of RAM consumed</span>
    <span class="n">fragment_readahead</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># Controls the number of files to load in memory ahead of time. This will have impacts on amount of RAM consumed</span>
    <span class="n">batch_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>  <span class="c1"># Controls the batchsize when to use when normalizing. This will have impacts on amount of RAM consumed</span>
    <span class="n">max_rows_per_file</span><span class="o">=</span><span class="mi">5000000</span><span class="p">,</span>  <span class="c1"># Controls the max number of rows per parquet file</span>
    <span class="n">max_rows_per_group</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
    <span class="n">min_rows_per_group</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># Controls the max number of rows per group parquet file</span>
<span class="n">normalize_dataset</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">normalize_config</span><span class="o">=</span><span class="n">normalize_config</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">show_row_group_metadata</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">file_sizes</span> <span class="o">=</span> <span class="n">list_file_sizes</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">db_path</span><span class="p">)</span>
<span class="k">for</span> <span class="n">file</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="n">file_sizes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">size</span><span class="si">}</span><span class="s2"> MB&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: normalize_dataset
Done with task: normalize_dataset
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
============================================================
PARQUETDB SUMMARY
============================================================
Database path: Z:\data\parquetdb\data\external\alexandria\AlexandriaDB\alexandria_3D

• Number of columns: 128
• Number of rows: 4389295
• Number of files: 1
• Number of rows per file: [4389295]
• Number of row groups per file: [22]
• Number of rows per row group per file:
    - alexandria_3D_0.parquet:
        - Row group 0: 200000 rows
        - Row group 1: 200000 rows
        - Row group 2: 200000 rows
        - Row group 3: 200000 rows
        - Row group 4: 200000 rows
        - Row group 5: 200000 rows
        - Row group 6: 200000 rows
        - Row group 7: 200000 rows
        - Row group 8: 200000 rows
        - Row group 9: 200000 rows
        - Row group 10: 200000 rows
        - Row group 11: 200000 rows
        - Row group 12: 200000 rows
        - Row group 13: 200000 rows
        - Row group 14: 200000 rows
        - Row group 15: 200000 rows
        - Row group 16: 200000 rows
        - Row group 17: 200000 rows
        - Row group 18: 200000 rows
        - Row group 19: 200000 rows
        - Row group 20: 200000 rows
        - Row group 21: 189295 rows
• Serialized metadata size per file: [377929] Bytes

############################################################
METADATA
############################################################

############################################################
COLUMN DETAILS
############################################################

alexandria_3D_0.parquet: 2767.2842226028442 MB
</pre></div></div>
</div>
</section>
<section id="Basic-Operations">
<h2>Basic Operations<a class="headerlink" href="#Basic-Operations" title="Link to this heading">¶</a></h2>
<p>In this section we are going to test the performance of ParquetDB for basic operations.</p>
<section id="Reading-a-single-column">
<h3>Reading a single column<a class="headerlink" href="#Reading-a-single-column" title="Link to this heading">¶</a></h3>
<p>If one were to want a single property for all materials in alexandria, if it were in json format, we would have to iterate over and read all the json files to collect the property.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">total_time_to_read_from_json</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">benchmark_dict</span><span class="p">[</span><span class="s2">&quot;json_load_times&quot;</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">read_single_column</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_single_column&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_single_column&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span> <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_single_column</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">read_single_column_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_single_column_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">read_single_column_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_single_column
(4389295, 1)
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 0.04 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
</section>
</section>
<section id="Reading-specific-ids">
<h2>Reading specific ids<a class="headerlink" href="#Reading-specific-ids" title="Link to this heading">¶</a></h2>
<p>Now, if we were to want speific columns, at minimum time to do this in json format would be the same time as iterating over the json files.</p>
<p>In ParquetDB, it is much simpler and less memory intensive to read specific ids.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_specific_ids</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_specific_ids&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_specific_ids&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
        <span class="n">ids</span><span class="o">=</span><span class="p">[</span>
            <span class="mi">0</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="mi">100</span><span class="p">,</span>
            <span class="mi">1000</span><span class="p">,</span>
            <span class="mi">10000</span><span class="p">,</span>
            <span class="mi">100000</span><span class="p">,</span>
            <span class="mi">1000000</span><span class="p">,</span>
        <span class="p">],</span>  <span class="c1"># Controls which rows we want to read</span>
        <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span>  <span class="c1"># Controls the output format. The options are &#39;table&#39;, &#39;batches&#39;, `dataset`.</span>
    <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>  <span class="c1"># Converts the table to a pandas dataframe</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data : </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;data.spg&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: read_specific_ids&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_specific_ids</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">read_specific_ids_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_specific_ids_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">read_specific_ids_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_specific_ids
0      10000
1          0
2         10
3        100
4       1000
5     100000
6    1000000
Name: id, dtype: int64
                   @class                            @module  composition.Ac  \
0  ComputedStructureEntry  pymatgen.entries.computed_entries             2.0
1  ComputedStructureEntry  pymatgen.entries.computed_entries             1.0
2  ComputedStructureEntry  pymatgen.entries.computed_entries             1.0
3  ComputedStructureEntry  pymatgen.entries.computed_entries             1.0
4  ComputedStructureEntry  pymatgen.entries.computed_entries             2.0

   composition.Ag  composition.Al  composition.Ar  composition.As  \
0             NaN             NaN             NaN             NaN
1             NaN             NaN             NaN             NaN
2             NaN             NaN             NaN             NaN
3             NaN             NaN             NaN             NaN
4             NaN             NaN             NaN             NaN

   composition.Au  composition.B  composition.Ba  ...  structure.lattice.a  \
0             NaN            NaN             NaN  ...             4.829086
1             NaN            NaN             NaN  ...            10.091510
2             NaN            NaN             NaN  ...            15.519920
3             NaN            NaN             NaN  ...             5.789011
4             NaN            NaN             NaN  ...             8.695520

   structure.lattice.alpha  structure.lattice.b  structure.lattice.beta  \
0                90.000000             4.829086               90.000000
1               109.471217            10.091510              109.471222
2                89.997963            11.000739               89.996986
3               111.411199             8.109282               99.469696
4                69.601810             7.709933               55.506047

   structure.lattice.c  structure.lattice.gamma  \
0             9.745281                90.000000
1            10.091511               109.471219
2             5.192681                45.191179
3             8.109282                99.469696
4             7.709933                55.506037

                            structure.lattice.matrix  structure.lattice.pbc  \
0  [4.82908586, 0.0, 0.0, 0.0, 4.82908586, 0.0, 0...     [True, True, True]
1  [9.51436671, 2e-08, -3.36383678, -4.75718337, ...     [True, True, True]
2  [15.51989271, -0.00721914, 0.02799947, 7.75631...     [True, True, True]
3  [5.78373142, -0.13705652, -0.20571227, -1.1463...     [True, True, True]
4  [7.92465233, 0.98010515, 3.44257929, 3.2101699...     [True, True, True]

   structure.lattice.volume                                    structure.sites
0                227.260645  [{&#39;abc&#39;: [0.0, 0.5, 0.2399718], &#39;label&#39;: &#39;Ac&#39;,...
1                791.127799  [{&#39;abc&#39;: [0.0, 0.0, 0.0], &#39;label&#39;: &#39;Ac&#39;, &#39;prop...
2                628.973408  [{&#39;abc&#39;: [3e-06, 3e-06, 0.0], &#39;label&#39;: &#39;Ac&#39;, &#39;...
3                338.968680  [{&#39;abc&#39;: [0.5, 0.0, 0.0], &#39;label&#39;: &#39;Ac&#39;, &#39;prop...
4                350.818535  [{&#39;abc&#39;: [0.83221258, 0.94982224, 0.94982224],...

[5 rows x 128 columns]
(7, 128)
[dtype(&#39;O&#39;), dtype(&#39;int64&#39;), dtype(&#39;float64&#39;)]
Data : 129
[&#39;@class&#39;, &#39;@module&#39;, &#39;composition.Ac&#39;, &#39;composition.Ag&#39;, &#39;composition.Al&#39;, &#39;composition.Ar&#39;, &#39;composition.As&#39;, &#39;composition.Au&#39;, &#39;composition.B&#39;, &#39;composition.Ba&#39;, &#39;composition.Be&#39;, &#39;composition.Bi&#39;, &#39;composition.Br&#39;, &#39;composition.C&#39;, &#39;composition.Ca&#39;, &#39;composition.Cd&#39;, &#39;composition.Ce&#39;, &#39;composition.Cl&#39;, &#39;composition.Co&#39;, &#39;composition.Cr&#39;, &#39;composition.Cs&#39;, &#39;composition.Cu&#39;, &#39;composition.Dy&#39;, &#39;composition.Er&#39;, &#39;composition.Eu&#39;, &#39;composition.F&#39;, &#39;composition.Fe&#39;, &#39;composition.Ga&#39;, &#39;composition.Gd&#39;, &#39;composition.Ge&#39;, &#39;composition.H&#39;, &#39;composition.He&#39;, &#39;composition.Hf&#39;, &#39;composition.Hg&#39;, &#39;composition.Ho&#39;, &#39;composition.I&#39;, &#39;composition.In&#39;, &#39;composition.Ir&#39;, &#39;composition.K&#39;, &#39;composition.Kr&#39;, &#39;composition.La&#39;, &#39;composition.Li&#39;, &#39;composition.Lu&#39;, &#39;composition.Mg&#39;, &#39;composition.Mn&#39;, &#39;composition.Mo&#39;, &#39;composition.N&#39;, &#39;composition.Na&#39;, &#39;composition.Nb&#39;, &#39;composition.Nd&#39;, &#39;composition.Ne&#39;, &#39;composition.Ni&#39;, &#39;composition.Np&#39;, &#39;composition.O&#39;, &#39;composition.Os&#39;, &#39;composition.P&#39;, &#39;composition.Pa&#39;, &#39;composition.Pb&#39;, &#39;composition.Pd&#39;, &#39;composition.Pm&#39;, &#39;composition.Pr&#39;, &#39;composition.Pt&#39;, &#39;composition.Pu&#39;, &#39;composition.Rb&#39;, &#39;composition.Re&#39;, &#39;composition.Rh&#39;, &#39;composition.Ru&#39;, &#39;composition.S&#39;, &#39;composition.Sb&#39;, &#39;composition.Sc&#39;, &#39;composition.Se&#39;, &#39;composition.Si&#39;, &#39;composition.Sm&#39;, &#39;composition.Sn&#39;, &#39;composition.Sr&#39;, &#39;composition.Ta&#39;, &#39;composition.Tb&#39;, &#39;composition.Tc&#39;, &#39;composition.Te&#39;, &#39;composition.Th&#39;, &#39;composition.Ti&#39;, &#39;composition.Tl&#39;, &#39;composition.Tm&#39;, &#39;composition.U&#39;, &#39;composition.V&#39;, &#39;composition.W&#39;, &#39;composition.Xe&#39;, &#39;composition.Y&#39;, &#39;composition.Yb&#39;, &#39;composition.Zn&#39;, &#39;composition.Zr&#39;, &#39;correction&#39;, &#39;data.band_gap_dir&#39;, &#39;data.band_gap_ind&#39;, &#39;data.decomposition&#39;, &#39;data.dos_ef&#39;, &#39;data.e_above_hull&#39;, &#39;data.e_form&#39;, &#39;data.e_phase_separation&#39;, &#39;data.elements&#39;, &#39;data.energy_corrected&#39;, &#39;data.energy_total&#39;, &#39;data.formula&#39;, &#39;data.location&#39;, &#39;data.mat_id&#39;, &#39;data.nsites&#39;, &#39;data.prototype_id&#39;, &#39;data.spg&#39;, &#39;data.stress&#39;, &#39;data.total_mag&#39;, &#39;energy&#39;, &#39;energy_adjustments&#39;, &#39;entry_id&#39;, &#39;id&#39;, &#39;parameters.dummy_field&#39;, &#39;structure.@class&#39;, &#39;structure.@module&#39;, &#39;structure.charge&#39;, &#39;structure.lattice.a&#39;, &#39;structure.lattice.alpha&#39;, &#39;structure.lattice.b&#39;, &#39;structure.lattice.beta&#39;, &#39;structure.lattice.c&#39;, &#39;structure.lattice.gamma&#39;, &#39;structure.lattice.matrix&#39;, &#39;structure.lattice.pbc&#39;, &#39;structure.lattice.volume&#39;, &#39;structure.sites&#39;]
Done with task: read_specific_ids
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 4.16 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
<section id="Finding-the-minimum-and-maximum-of-a-energy">
<h3>Finding the minimum and maximum of a energy<a class="headerlink" href="#Finding-the-minimum-and-maximum-of-a-energy" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_energy_min_max</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_energy_min_max&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_energy_min_max&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">],</span> <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">pc</span><span class="o">.</span><span class="n">min_max</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;energy&quot;</span><span class="p">])</span>
    <span class="c1"># The result will be a struct with &#39;min&#39; and &#39;max&#39; fields</span>
    <span class="n">min_value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">as_py</span><span class="p">()</span>
    <span class="n">max_value</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">as_py</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Min: </span><span class="si">{</span><span class="n">min_value</span><span class="si">}</span><span class="s2">, Max: </span><span class="si">{</span><span class="n">max_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: read_energy_min_max&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_energy_min_max</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">read_energy_min_max_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_energy_min_max_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">read_energy_min_max_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_energy_min_max
(4389295, 1)
Min: -1496.5922219, Max: -0.003981
Done with task: read_energy_min_max
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 0.35 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
</section>
<section id="Reading-records-filtered-by-energy-above--1.0">
<h3>Reading records filtered by energy above -1.0<a class="headerlink" href="#Reading-records-filtered-by-energy-above--1.0" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_filtered_energy_above_minus_one</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_filtered_energy_above_-1&quot;</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read records filtered by energy above -1.0 and track timing.&quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_filtered_energy_above_minus_one&quot;</span><span class="p">)</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;energy&quot;</span><span class="p">],</span>
        <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;energy&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">],</span>
        <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>  <span class="c1"># Converts the table to a pandas dataframe</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: read_filtered_energy_above_minus_one&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_filtered_energy_above_minus_one</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">read_filtered_energy_above_minus_one_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_filtered_energy_above_minus_one_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">read_filtered_energy_above_minus_one_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_filtered_energy_above_minus_one
       id    energy
0  123136 -0.063105
1  123137 -0.125970
2  403318 -0.972671
3  570682 -0.907343
4  570683 -0.901483
(46, 2)
Done with task: read_filtered_energy_above_minus_one
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 0.04 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
</section>
<section id="Reading-records-filtered-by-spg-204">
<h3>Reading records filtered by spg 204<a class="headerlink" href="#Reading-records-filtered-by-spg-204" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_filtered_spg_204</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_filtered_spg_204_table&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_filtered_spg_204&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;data.spg&quot;</span><span class="p">],</span>
        <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;data.spg&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">204</span><span class="p">],</span>
        <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>  <span class="c1"># Converts the table to a pandas dataframe</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: read_filtered_spg_204&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_filtered_spg_204</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">read_filtered_spg_204_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_filtered_spg_204_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">read_filtered_spg_204_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_filtered_spg_204
      id  data.spg
0  10113       204
1  10125       204
2  10126       204
3  10133       204
4  10140       204
(7240, 2)
Done with task: read_filtered_spg_204
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 0.05 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
</section>
<section id="Reading-records-filtered-by-spg-batches">
<h3>Reading records filtered by spg batches<a class="headerlink" href="#Reading-records-filtered-by-spg-batches" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_filtered_spg_batches</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_filtered_spg_batches&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_filtered_spg_batches&quot;</span><span class="p">)</span>
    <span class="n">generator</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
        <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;batches&quot;</span><span class="p">,</span>
        <span class="n">batch_size</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">load_config</span><span class="o">=</span><span class="n">LoadConfig</span><span class="p">(</span>
            <span class="n">batch_readahead</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">fragment_readahead</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">fragment_scan_options</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">use_threads</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">memory_pool</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;data.spg&quot;</span><span class="p">],</span>
        <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;data.spg&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">204</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">batch_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_rows</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">table</span> <span class="ow">in</span> <span class="n">generator</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span>
        <span class="n">num_rows</span> <span class="o">+=</span> <span class="n">table</span><span class="o">.</span><span class="n">num_rows</span>
        <span class="n">batch_count</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total number of rows: </span><span class="si">{</span><span class="n">num_rows</span><span class="si">}</span><span class="s2">, Batches: </span><span class="si">{</span><span class="n">batch_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: read_filtered_spg_batches&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_filtered_spg_batches</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">read_filtered_spg_batches_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_filtered_spg_batches_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">read_filtered_spg_batches_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_filtered_spg_batches
Total number of rows: 7240, Batches: 4390
Done with task: read_filtered_spg_batches
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 0.76 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
</section>
<section id="Reading-lattice-matrix-for-space-group-204">
<h3>Reading lattice matrix for space group 204<a class="headerlink" href="#Reading-lattice-matrix-for-space-group-204" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_lattice_matrix_spg_204</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_lattice_matrix_spg_204&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_lattice_matrix_spg_204&quot;</span><span class="p">)</span>

    <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;structure.lattice.matrix&quot;</span><span class="p">],</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="n">pc</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="s2">&quot;data.spg&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">204</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">lattice</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;structure.lattice.matrix&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">combine_chunks</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy_ndarray</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lattice</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: read_lattice_matrix_spg_204&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_lattice_matrix_spg_204</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">read_lattice_matrix_spg_204_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_lattice_matrix_spg_204_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">read_lattice_matrix_spg_204_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_lattice_matrix_spg_204
(7240, 3, 3)
Done with task: read_lattice_matrix_spg_204
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 0.63 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
</section>
<section id="Reading-nested-column-selection">
<h3>Reading nested column selection<a class="headerlink" href="#Reading-nested-column-selection" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_nested_column_selection</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_nested_column_selection&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_nested_column_selection&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="s2">&quot;structure.sites&quot;</span><span class="p">],</span> <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;structure.sites&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;structure.sites&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">combine_chunks</span><span class="p">()</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: read_nested_column_selection&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_nested_column_selection</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">read_nested_column_selection_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">read_nested_column_selection_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">read_nested_column_selection_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_nested_column_selection
(4389295, 2)
list&lt;element: struct&lt;abc: list&lt;element: double&gt;, label: string, properties: struct&lt;charge: double, forces: list&lt;element: double&gt;, magmom: double&gt;, species: list&lt;element: struct&lt;element: string, occu: int64&gt;&gt;, xyz: list&lt;element: double&gt;&gt;&gt;
list&lt;element: struct&lt;abc: list&lt;element: double&gt;, label: string, properties: struct&lt;charge: double, forces: list&lt;element: double&gt;, magmom: double&gt;, species: list&lt;element: struct&lt;element: string, occu: int64&gt;&gt;, xyz: list&lt;element: double&gt;&gt;&gt;
Done with task: read_nested_column_selection
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 3.53 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
</section>
<section id="Nested-structure-into-class">
<h3>Nested structure into class<a class="headerlink" href="#Nested-structure-into-class" title="Link to this heading">¶</a></h3>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_nested_structure_into_class</span><span class="p">(</span><span class="n">db</span><span class="p">):</span>
    <span class="c1"># By default the database flattens nested structure for storage.</span>
    <span class="c1"># However, we provide an option to rebuild the nested structure. This will create a new dataset in {dataset_name}_nested.</span>
    <span class="c1"># After the creation of the new dataset, the query parameters are applied to the new dataset.</span>
    <span class="n">task_name</span> <span class="o">=</span> <span class="s2">&quot;read_nested_structure_into_class&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting task: read_nested_structure_into_class&quot;</span><span class="p">)</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">read</span><span class="p">(</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
            <span class="s2">&quot;structure&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="p">,</span>
        <span class="p">],</span>  <span class="c1"># Instead of using the flatten syntax, we can use the nested syntax</span>
        <span class="n">ids</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1000000</span><span class="p">],</span>
        <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;table&quot;</span><span class="p">,</span>
        <span class="n">rebuild_nested_struct</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># When set to True to rebuild the nested structure</span>
        <span class="n">rebuild_nested_from_scratch</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># When set to True, the nested structure will be rebuilt from scratch</span>
        <span class="n">normalize_config</span><span class="o">=</span><span class="n">NormalizeConfig</span><span class="p">(</span>
            <span class="n">load_format</span><span class="o">=</span><span class="s2">&quot;batches&quot;</span><span class="p">,</span>
            <span class="n">batch_readahead</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">fragment_readahead</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="mi">10000</span><span class="p">,</span>
            <span class="n">max_rows_per_file</span><span class="o">=</span><span class="mi">5000000</span><span class="p">,</span>
            <span class="n">min_rows_per_group</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
            <span class="n">max_rows_per_group</span><span class="o">=</span><span class="mi">200000</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;structure type&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">pymatgen.core.structure</span> <span class="kn">import</span> <span class="n">Structure</span>

        <span class="n">structure</span> <span class="o">=</span> <span class="n">Structure</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span>
            <span class="n">table</span><span class="p">[</span><span class="s2">&quot;structure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">combine_chunks</span><span class="p">()</span><span class="o">.</span><span class="n">to_pylist</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">structure</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done with task: read_nested_structure_into_class&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">200</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">task_name</span>


<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">read_nested_structure_into_class</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">nested_structure_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">nested_structure_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_nested_structure_into_class
(2, 3)
struct&lt;band_gap_dir: double, band_gap_ind: double, decomposition: string, dos_ef: double, e_above_hull: double, e_form: double, e_phase_separation: double, elements: list&lt;element: string&gt;, energy_corrected: double, energy_total: double, formula: string, location: string, mat_id: string, nsites: int64, prototype_id: string, spg: int64, stress: extension&lt;arrow.fixed_shape_tensor[value_type=double, shape=[3,3]]&gt;, total_mag: double&gt;
structure type
struct&lt;@class: string, @module: string, charge: int64, lattice: struct&lt;a: double, alpha: double, b: double, beta: double, c: double, gamma: double, matrix: extension&lt;arrow.fixed_shape_tensor[value_type=double, shape=[3,3]]&gt;, pbc: extension&lt;arrow.fixed_shape_tensor[value_type=bool, shape=[3]]&gt;, volume: double&gt;, sites: list&lt;element: struct&lt;abc: list&lt;element: double&gt;, label: string, properties: struct&lt;charge: double, forces: list&lt;element: double&gt;, magmom: double&gt;, species: list&lt;element: struct&lt;element: string, occu: int64&gt;&gt;, xyz: list&lt;element: double&gt;&gt;&gt;&gt;
Full Formula (Ac1 Pr12 Ho7)
Reduced Formula: AcPr12Ho7
abc   :  10.091510  10.091510  10.091511
angles: 109.471217 109.471222 109.471219
pbc   :       True       True       True
Sites (20)
  #  SP           a         b         c    charge  forces                                     magmom
---  ----  --------  --------  --------  --------  ---------------------------------------  --------
  0  Ac    0         0         0            8.076  [0.0, -0.0, -0.0]                              -0
  1  Pr    0.476206  0.707375  0.768831     8.873  [0.0022184, 0.00231648, -0.00126846]           -0
  2  Pr    0.938545  0.707375  0.231169     8.873  [0.00045645, 0.00231648, -0.00251434]          -0
  3  Pr    0.523794  0.292625  0.231169     8.873  [-0.0022184, -0.00231648, 0.00126846]          -0
  4  Pr    0.061455  0.292625  0.768831     8.873  [-0.00045645, -0.00231648, 0.00251434]         -0
  5  Pr    0.768831  0.061455  0.292625     8.873  [0.00177791, -0.00155354, -0.00251434]         -0
  6  Pr    0.768831  0.476206  0.707375     8.873  [-0.00089694, 0.00307943, 0.00126846]          -0
  7  Pr    0.231169  0.938545  0.707375     8.873  [-0.00177791, 0.00155354, 0.00251434]          -0
  8  Pr    0.231169  0.523794  0.292625     8.873  [0.00089694, -0.00307943, -0.00126846]         -0
  9  Pr    0.707375  0.768831  0.476206     8.873  [0.00223436, 0.00076295, 0.00251434]           -0
 10  Pr    0.292625  0.231169  0.523794     8.873  [-0.00223436, -0.00076295, -0.00251434]        -0
 11  Pr    0.707375  0.231169  0.938545     8.873  [0.00311533, -0.00076295, 0.00126846]          -0
 12  Pr    0.292625  0.768831  0.061455     8.873  [-0.00311533, 0.00076295, -0.00126846]         -0
 13  Ho    0.5       0.5       0            7.546  [-0.0, -0.0, -0.0]                              0
 14  Ho    0         0.5       0.5          7.546  [0.0, -0.0, -0.0]                               0
 15  Ho    0.5       0         0.5          7.546  [-0.0, -0.0, -0.0]                              0
 16  Ho    0.5       0.5       0.5          8.703  [-0.0, -0.0, -0.0]                              0
 17  Ho    0         0         0.5          8.703  [-0.0, -0.0, -0.0]                              0
 18  Ho    0.5       0         0            8.703  [-0.0, -0.0, -0.0]                              0
 19  Ho    0         0.5       0            8.703  [-0.0, -0.0, -0.0]                              0
Done with task: read_nested_structure_into_class
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 26.94 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
<p>In the previous cell it takes ~ 60 seconds to perform the operation, this is due to reconstructing the nested structure. Further queries will be faster as the nested structure is already built.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">task_name</span> <span class="o">=</span> <span class="n">read_nested_structure_into_class</span><span class="p">(</span><span class="n">db</span><span class="p">)</span>
<span class="n">nested_structure_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">task_name</span><span class="p">)</span>
<span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nested_structure_time</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from parquetdb: </span><span class="si">{</span><span class="n">nested_structure_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time to read from json: </span><span class="si">{</span><span class="n">total_time_to_read_from_json</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Starting task: read_nested_structure_into_class
(2, 3)
struct&lt;band_gap_dir: double, band_gap_ind: double, decomposition: string, dos_ef: double, e_above_hull: double, e_form: double, e_phase_separation: double, elements: list&lt;element: string&gt;, energy_corrected: double, energy_total: double, formula: string, location: string, mat_id: string, nsites: int64, prototype_id: string, spg: int64, stress: extension&lt;arrow.fixed_shape_tensor[value_type=double, shape=[3,3]]&gt;, total_mag: double&gt;
structure type
struct&lt;@class: string, @module: string, charge: int64, lattice: struct&lt;a: double, alpha: double, b: double, beta: double, c: double, gamma: double, matrix: extension&lt;arrow.fixed_shape_tensor[value_type=double, shape=[3,3]]&gt;, pbc: extension&lt;arrow.fixed_shape_tensor[value_type=bool, shape=[3]]&gt;, volume: double&gt;, sites: list&lt;element: struct&lt;abc: list&lt;element: double&gt;, label: string, properties: struct&lt;charge: double, forces: list&lt;element: double&gt;, magmom: double&gt;, species: list&lt;element: struct&lt;element: string, occu: int64&gt;&gt;, xyz: list&lt;element: double&gt;&gt;&gt;&gt;
Full Formula (Ac1 Pr12 Ho7)
Reduced Formula: AcPr12Ho7
abc   :  10.091510  10.091510  10.091511
angles: 109.471217 109.471222 109.471219
pbc   :       True       True       True
Sites (20)
  #  SP           a         b         c    charge  forces                                     magmom
---  ----  --------  --------  --------  --------  ---------------------------------------  --------
  0  Ac    0         0         0            8.076  [0.0, -0.0, -0.0]                              -0
  1  Pr    0.476206  0.707375  0.768831     8.873  [0.0022184, 0.00231648, -0.00126846]           -0
  2  Pr    0.938545  0.707375  0.231169     8.873  [0.00045645, 0.00231648, -0.00251434]          -0
  3  Pr    0.523794  0.292625  0.231169     8.873  [-0.0022184, -0.00231648, 0.00126846]          -0
  4  Pr    0.061455  0.292625  0.768831     8.873  [-0.00045645, -0.00231648, 0.00251434]         -0
  5  Pr    0.768831  0.061455  0.292625     8.873  [0.00177791, -0.00155354, -0.00251434]         -0
  6  Pr    0.768831  0.476206  0.707375     8.873  [-0.00089694, 0.00307943, 0.00126846]          -0
  7  Pr    0.231169  0.938545  0.707375     8.873  [-0.00177791, 0.00155354, 0.00251434]          -0
  8  Pr    0.231169  0.523794  0.292625     8.873  [0.00089694, -0.00307943, -0.00126846]         -0
  9  Pr    0.707375  0.768831  0.476206     8.873  [0.00223436, 0.00076295, 0.00251434]           -0
 10  Pr    0.292625  0.231169  0.523794     8.873  [-0.00223436, -0.00076295, -0.00251434]        -0
 11  Pr    0.707375  0.231169  0.938545     8.873  [0.00311533, -0.00076295, 0.00126846]          -0
 12  Pr    0.292625  0.768831  0.061455     8.873  [-0.00311533, 0.00076295, -0.00126846]         -0
 13  Ho    0.5       0.5       0            7.546  [-0.0, -0.0, -0.0]                              0
 14  Ho    0         0.5       0.5          7.546  [0.0, -0.0, -0.0]                               0
 15  Ho    0.5       0         0.5          7.546  [-0.0, -0.0, -0.0]                              0
 16  Ho    0.5       0.5       0.5          8.703  [-0.0, -0.0, -0.0]                              0
 17  Ho    0         0         0.5          8.703  [-0.0, -0.0, -0.0]                              0
 18  Ho    0.5       0         0            8.703  [-0.0, -0.0, -0.0]                              0
 19  Ho    0         0.5       0            8.703  [-0.0, -0.0, -0.0]                              0
Done with task: read_nested_structure_into_class
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Time to read from parquetdb: 2.67 seconds
Time to read from json: 0.00 seconds
</pre></div></div>
</div>
</section>
<section id="Plotting-times">
<h3>Plotting times<a class="headerlink" href="#Plotting-times" title="Link to this heading">¶</a></h3>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">parquetdb.utils</span> <span class="kn">import</span> <span class="n">matplotlib_utils</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">rcParams</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1.inset_locator</span> <span class="kn">import</span> <span class="n">inset_axes</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xlabel_size</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">ylabel_size</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">title_size</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">xtick_size</span> <span class="o">=</span> <span class="mi">14</span>
<span class="n">ytick_size</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">inset_xtick_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">inset_ytick_size</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">inset_title_size</span> <span class="o">=</span> <span class="mi">12</span>

<span class="n">labels</span> <span class="o">=</span> <span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_names&quot;</span><span class="p">]</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">task_benchmark_dict</span><span class="p">[</span><span class="s2">&quot;task_times&quot;</span><span class="p">]</span>
<span class="c1"># Create the main plot with numbered x labels and an inset showing the same data on a log scale</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="c1"># Number the labels</span>
<span class="n">numbered_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">labels</span><span class="p">)]</span>

<span class="c1"># matplotlib_utils.set_palette(&#39;Cavalcanti1&#39;)</span>
<span class="n">matplotlib_utils</span><span class="o">.</span><span class="n">set_palette</span><span class="p">(</span><span class="s2">&quot;Darjeeling1_alt&quot;</span><span class="p">)</span>
<span class="c1"># matplotlib_utils.set_palette(&#39;Zissou1&#39;)</span>
<span class="c1"># matplotlib_utils.set_palette(&#39;AsteroidCity1&#39;)</span>
<span class="c1"># matplotlib_utils.set_palette(&#39;BottleRocket2&#39;)</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;axes.prop_cycle&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">by_key</span><span class="p">()[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span>
<span class="c1"># Main horizontal bar plotcolors[:len(times)]</span>
<span class="c1"># ax.barh(numbered_labels, times, color=&quot;#59b9de&quot;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="n">numbered_labels</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Total Time (seconds)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">xlabel_size</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Operations&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">ylabel_size</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">xtick_size</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">ytick_size</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
    <span class="s2">&quot;Total Time for Various Operations on dataset with 4.8 million rows&quot;</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="n">title_size</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Inset plot with log scale and just the numbers</span>
<span class="c1"># ax_inset = inset_axes(ax, width=&quot;40%&quot;, height=&quot;30%&quot;, loc=&quot;center right&quot;)</span>

<span class="n">ax_inset</span> <span class="o">=</span> <span class="n">inset_axes</span><span class="p">(</span>
    <span class="n">ax</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="s2">&quot;30%&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="s2">&quot;30%&quot;</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center right&quot;</span><span class="p">,</span>
    <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">bbox_transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">ax_inset</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">times</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#e52207&quot;</span><span class="p">)</span>
<span class="n">ax_inset</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">times</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)])</span>
<span class="n">ax_inset</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">ax_inset</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1"># Show just the numbers</span>
<span class="n">ax_inset</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">inset_ytick_size</span><span class="p">)</span>
<span class="n">ax_inset</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Log Scale&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">inset_title_size</span><span class="p">)</span>

<span class="c1"># Adjust layout and show the plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
C:\Users\lllang\AppData\Local\Temp\ipykernel_67684\1793184629.py:57: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.tight_layout()
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/examples_notebooks_Example_1_-_3D_Alexandria_Database_49_1.png" src="../../_images/examples_notebooks_Example_1_-_3D_Alexandria_Database_49_1.png" />
</div>
</div>
</section>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="Example%202%20-%203D%20Alexandria%20Advanced.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">3D Alexandria Advanced</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../index.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Examples for the ParquetDB package</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2024, Logan Lang
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">3D Alexandria Database</a><ul>
<li><a class="reference internal" href="#Setup">Setup</a><ul>
<li><a class="reference internal" href="#Setup-data-directories">Setup data directories</a></li>
<li><a class="reference internal" href="#Download-the-database">Download the database</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Creating-the-database">Creating the database</a><ul>
<li><a class="reference internal" href="#Inputing-the-data">Inputing the data</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Normalizing-the-dataset">Normalizing the dataset</a></li>
<li><a class="reference internal" href="#Basic-Operations">Basic Operations</a><ul>
<li><a class="reference internal" href="#Reading-a-single-column">Reading a single column</a></li>
</ul>
</li>
<li><a class="reference internal" href="#Reading-specific-ids">Reading specific ids</a><ul>
<li><a class="reference internal" href="#Finding-the-minimum-and-maximum-of-a-energy">Finding the minimum and maximum of a energy</a></li>
<li><a class="reference internal" href="#Reading-records-filtered-by-energy-above--1.0">Reading records filtered by energy above -1.0</a></li>
<li><a class="reference internal" href="#Reading-records-filtered-by-spg-204">Reading records filtered by spg 204</a></li>
<li><a class="reference internal" href="#Reading-records-filtered-by-spg-batches">Reading records filtered by spg batches</a></li>
<li><a class="reference internal" href="#Reading-lattice-matrix-for-space-group-204">Reading lattice matrix for space group 204</a></li>
<li><a class="reference internal" href="#Reading-nested-column-selection">Reading nested column selection</a></li>
<li><a class="reference internal" href="#Nested-structure-into-class">Nested structure into class</a></li>
<li><a class="reference internal" href="#Plotting-times">Plotting times</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=7ca58008"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/custom.js"></script>
    </body>
</html>